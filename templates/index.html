<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>阪口・タン研究室へようこそ！<br>Welcome to Sakaguchi-Tran Lab</title>
  <style>
  /* 全局设置 */
  body {
    font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
    background: linear-gradient(135deg, #e8f0ff, #f9fbff);
    text-align: center;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* 标题部分 */
  h2 {
    color: #1a1a40;
    margin-top: 60px;
    margin-bottom: 25px;
    font-size: 28px;
    letter-spacing: 1px;
  }

  /* 输入框 */
  input {
    padding: 12px;
    font-size: 16px;
    border-radius: 10px;
    border: 1.5px solid #c5cae9;
    width: 80%;
    max-width: 280px;
    outline: none;
    transition: 0.2s;
  }

  input:focus {
    border-color: #4e73df;
    box-shadow: 0 0 6px rgba(78, 115, 223, 0.3);
  }

  /* 按钮样式 */
  button {
    padding: 10px 22px;
    margin-top: 20px;
    background-color: #4e73df;
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
    box-shadow: 0 4px 10px rgba(78, 115, 223, 0.2);
  }

  button:hover {
    background-color: #3b5bcc;
    transform: translateY(-1px);
  }

  /* 信息显示卡片 */
  #waiting_info, #result {
    margin-top: 40px;
    font-size: 20px;
    font-weight: bold;
    color: #333;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    width: 85%;
    max-width: 400px;
    line-height: 1.6;
  }

  #waiting_info {
    color: #d71717;
  }

  /* 管理员按钮固定右上角 */
  #adminBtn {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #4e73df;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 18px;
    font-size: 15px;
    cursor: pointer;
    box-shadow: 0 3px 8px rgba(78,115,223,0.3);
    transition: 0.3s;
  }

  #adminBtn:hover {
    background-color: #3756c0;
  }

  /* 响应式适配 */
  @media (max-width: 600px) {
    h2 {
      font-size: 22px;
      margin-top: 40px;
    }
    button {
      font-size: 15px;
      padding: 9px 18px;
    }
    input {
      width: 90%;
    }
    #waiting_info, #result {
      font-size: 18px;
    }
  }
  </style>

</head>

<body>
  <h2>阪口・タン研究室へようこそ！<br>Welcome to Sakaguchi-Tran Lab</h2>
  <img src="/static/pic/input.png" alt="lab logo" width="60" height="60">
  <p style="font-size:25px; color:#000000; margin-top:15px;">
  整理券システム Queue System
  </p>
  <br>
  <p id=waiting_info style="font-size:18px; color:#000000; margin-top:15px;">
    現在の待ち人数：<br>
    予想待ち時間：分<br>
    現在呼び出し中の番号 Now Calling：番
  </p>
  <br>
  <input type="text" id="name" placeholder="名前入力 Please input your name ">
  <br> 
  <button onclick="getNumber()">番号を取る<br>Get an order</button>
  <button onclick="checkPosition()">情報確認<br>Info check</button>
  <button id="adminBtn" onclick="adminLogin()">AdminPage</button>
  <p id="result">
    名前を入力して番号お取りください<br>
    情報確認を押して予約情報確認できます<br>
    Input name and press Get an order<br>
    Press Press Info check to check your reservation
  </p>
  <p style="font-size:23px; color:#000000; margin-top:15px; text-align:left">
  注意事項<br>
・整理券は「ゲーム体験」のものです。研究発表は予約なしでご聴講頂けます<br>
・２回目の呼び出しに応じない場合、整理券は無効とさせていただきます<br>
・高校生ツアーのお客様が優先になります<br>
・機器不良によりＶＲは使用できません。モニターでゲームを行います<br>
・至らぬ点は"たくさん"ございますが、どうかお楽しみください
</p>

  <script>
    async function getNumber() {
      let name = document.getElementById("name").value;

      let res = await fetch("/get_number", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: name })
      });

      let data = await res.json();
      if (data.status == 0) {
        document.getElementById("result").innerHTML = `
        あなたの番号は：${data.number}番<br>
        Your number is: ${data.number}<br>
        情報確認を押して予約情報確認できます<br>
        Press Info check to check your reservation`
      } else if (data.status == 2) {
        document.getElementById("result").innerHTML = "名前は占用されました！" + "<br>Your name has been used!";
      } else {
        document.getElementById("result").innerHTML = "名前を入力してください！" + "<br>Pleasr input your name first!";
      }
    }

    async function checkPosition() {
      let name = document.getElementById("name").value;
      if (!name) {
        document.getElementById("result").innerHTML = "名前を入力してください！" + "<br>Pleasr input your name first!";
        return;
      }

      let res = await fetch("/check_position", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: name })
      });

      let data = await res.json();
      if (data.status == "no user") {
        document.getElementById("result").innerHTML = "名前は見つかりません" + "<br>User not found";
      }else if (data.status == "passed"){
        document.getElementById("result").innerHTML = `
        あなたの番号は：${data.id}番<br>
        Your number is: ${data.id}<br>
        お呼びしましたが、ご不在のため次の順番で再度お呼びいたします<br>
        We called your number, but you were not present. You will be called again in the next round.
        `
      }else if (data.status == "expired"){
        document.getElementById("result").innerHTML = `
        あなたの番号は：${data.id}番<br>
        Your number is: ${data.id}<br>
        2回お呼びしましたが、ご不在のため、番号は無効となりました。再度受付をお願いいたします<br>
        Your number has been called twice with no response. It has been cancelled. Please take a new number.
        `
      }else if (data.status == "checked"){
        document.getElementById("result").innerHTML = `
        あなたの番号は：${data.id}番<br>
        Your number is: ${data.id}<br>
        ご体験ありがとうございました！<br>
        Thank you for your playing!
        `
      }
      else {
        document.getElementById("result").innerHTML = `
        あなたの番号は：${data.id}番<br>
        Your number is: ${data.id}<br>
        現在あなたの前には：${data.waiting}人がいます<br>
        There are ${data.waiting} people waiting ahead of you<br>
        `
      }
    }

    async function getWaitingNum(){
      try {
        const res = await fetch("/get_queue_length");
        const data = await res.json();

        if (data.status == 0) {
          document.getElementById("waiting_info").innerHTML = `
            現在の待ち人数：${data.queue_length}<br>
            予想待ち時間：${data.queue_time}分<br>
            現在呼び出し中の番号 Now Calling：${data.index}番
          `
        } else {
          document.getElementById("waiting_info").innerText = "エラー発生";
        }
      } catch (err) {
        document.getElementById("waiting_info").innerText = "エラー発生2";
        console.error(err);
      }
    }

    async function adminLogin() {
      window.location.href = "/adminlogin"; 
    }

    setInterval(getWaitingNum, 3000);
  </script>
</body>
</html>

